<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hd.ibus.mapper.IbusNodeCustomMapper" >
 <resultMap id="BaseResultMap" type="com.hd.ibus.pojo.IbusNode">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 20 17:08:04 CST 2016.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="node_name" jdbcType="VARCHAR" property="nodeName" />
    <result column="node_address" jdbcType="INTEGER" property="nodeAddress" />
    <result column="node_type" jdbcType="INTEGER" property="nodeType" />
    <result column="node_type2" jdbcType="INTEGER" property="nodeType2" />
    <result column="node_state" jdbcType="INTEGER" property="nodeState" />
    <result column="y" jdbcType="INTEGER" property="y" />
    <result column="x" jdbcType="INTEGER" property="x" />
    <result column="v_mix" jdbcType="FLOAT" property="vMix" />
    <result column="v_max" jdbcType="FLOAT" property="vMax" />
    <result column="i_max" jdbcType="FLOAT" property="iMax" />
    <result column="tp_max" jdbcType="FLOAT" property="tpMax" />
    <result column="group_id" jdbcType="INTEGER" property="groupId" />
    <result column="gateway_id" jdbcType="INTEGER" property="gatewayId" />
    <result column="node_isonline" jdbcType="INTEGER" property="nodeIsonline" />
    <result column="node_name2" jdbcType="VARCHAR" property="nodeName2" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 20 17:08:04 CST 2016.
    -->
    id, node_name, node_address, node_type, node_type2, node_state, y, x, v_mix, v_max, 
    i_max, tp_max, group_id, gateway_id, node_isonline, node_name2
  </sql>
  <!-- 用户查询 -->
	<select id="findList" parameterType="IbusNodeVo" resultMap="BaseResultMap">

		SELECT 
		<include refid="Base_Column_List" />
		from `ibus_node`
		

		<if test="pageBean!=null">
			limit ${pageBean.start},${pageBean.pageSize}
		</if>
	</select>
	

	<select id="findList2" parameterType="IbusNodeVo" resultType="map">

		select node.id,node.node_name,node.node_address,node.node_type,grou.group_name,gate.gateway_name,node.x,node.y,node.v_mix,node.v_max,node.i_max,node.tp_max   from  ibus_node node,ibus_gateway gate ,ibus_group grou 
		where gate.id=node.gateway_id 
		AND grou.id=node.group_id
		
			<if test="ibusNode != null">
			<if test="ibusNode.nodeName != null and ibusNode.nodeName != ''">
				AND node.node_name like '%${ibusNode.nodeName}%'
			</if>
			
			<if test="ibusNode.nodeAddress != null and ibusNode.nodeAddress != ''">
				AND node.node_address = ${ibusNode.nodeAddress}
			</if>
		</if>
		
		<if test="pageBean!=null">
			limit ${pageBean.start},${pageBean.pageSize}
		</if>
	</select>

	<select id="findOneByNodeAddr" parameterType="map" resultMap="BaseResultMap">

		SELECT 
		<include refid="Base_Column_List" />
		from `ibus_node`
		where gateway_id=#{gatewayId,jdbcType=INTEGER}
		and node_address=#{nodeAddr,jdbcType=INTEGER}
	</select>
	

	<select id="findListByGroupId" parameterType="int" resultMap="BaseResultMap">

		SELECT 
		<include refid="Base_Column_List" />
		from `ibus_node`
		where group_id = #{groupId,jdbcType=INTEGER}

		
	</select>
	
	
	
	<!-- 查询列表的总记录数 -->
	<select id="findTotal" parameterType="IbusNodeVo"
		resultType="int">
		
		select count(*) from `ibus_node`
		<where>
			1=1
			<if test="ibusNode != null">
			<if test="ibusNode.nodeName != null and ibusNode.nodeName != ''">
				AND node_name like '%${ibusNode.nodeName}%'
			</if>
			
			<if test="ibusNode.nodeAddress != null and ibusNode.nodeAddress != ''">
				AND node_address = ${ibusNode.nodeAddress}
			</if>
		</if>
		</where>

	</select>
	
	<!-- 查询节点信息，根据网关编号 -->
	<select id="getNodeByGateway" parameterType="java.lang.Integer"
		resultType="map">

		select g.group_name,g.group_name2,g.id as group_id,n.id as
		node_id,n.i_max,n.node_address,n.node_isonline,
		n.node_name,n.node_name2,n.node_state,n.node_type,n.tp_max,n.v_max,n.v_mix
	
		from ibus_group g,ibus_node n
	
		where n.gateway_id=#{gatewayId,jdbcType=INTEGER} and
		g.gateway_id=#{gatewayId,jdbcType=INTEGER} and g.id=n.group_id ORDER BY
		g.id,n.id;
		

	</select>
	
	<update id="updateByAddress" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 14:59:31 CST 2016.
    -->
	    update ibus_node
	    set 
	      node_state = #{nodeState,jdbcType=INTEGER}
	    where gateway_id =  #{gatewayId,jdbcType=INTEGER}
	    and node_address in
	    <foreach item="item" index="index" collection="nodes" open="("
			separator="," close=")">
			#{item}
		</foreach>
	    
	  </update>
	  
	  <update id="updateIsOnlineByAddress" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 14:59:31 CST 2016.
    -->
	    update ibus_node
	    set 
	      node_isonline = #{nodeIsonline,jdbcType=INTEGER}
	    where gateway_id =  #{gatewayId,jdbcType=INTEGER}
	    and node_address in
	    <foreach item="item" index="index" collection="nodes" open="("
			separator="," close=")">
			#{item}
		</foreach>
	    
	  </update>
 
 	<!-- 根据网关ID获取节点地址 -->
	<select id="findNodeBygatewayId" parameterType="java.lang.Integer"
		resultType="map">
		select 
		<include refid="Base_Column_List" />
		from ibus_node where gateway_id=#{gatewayId,jdbcType=INTEGER}
		and node_isonline=1
		
		

	</select>
	<insert id="insertFromExcel" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 08 17:11:17 CST 2016.
    -->
    insert into ibus_node (node_name,node_address,node_type,v_mix,v_max,i_max,tp_max)values (#{node_name, jdbcType=VARCHAR}, #{node_address,jdbcType=VARCHAR},#{node_type,jdbcType=INTEGER},#{v_mix,jdbcType=FLOAT}, #{v_max,jdbcType=FLOAT}, #{i_max,jdbcType=FLOAT}, #{tp_max,jdbcType=FLOAT})
     
  </insert>
	
<insert id="insertFromUrl" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Sep 08 17:11:17 CST 2016.
    -->
    insert into excel_url (fileurl, 
      insertdate, filename,
      )values (#{fileurl,jdbcType=VARCHAR}, #{insertdate,jdbcType=TIMESTAMP},  #{filename,jdbcType=VARCHAR})
     
  </insert>
</mapper>